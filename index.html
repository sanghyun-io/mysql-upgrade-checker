<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MySQL 8.0 ‚Üí 8.4 ÏóÖÍ∑∏Î†àÏù¥Îìú Í≤ÄÏ¶ùÍ∏∞</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=Manrope:wght@400;600;700;800&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #0066cc;
            --primary-dark: #004c99;
            --success: #00a86b;
            --warning: #ff8c00;
            --error: #dc143c;
            --bg-dark: #0a0e1a;
            --bg-card: #151b2e;
            --bg-elevated: #1e2739;
            --text-primary: #e8eaed;
            --text-secondary: #9aa0a6;
            --border: #2d3548;
            --accent-blue: #4dabf7;
            --accent-purple: #b197fc;
        }

        body {
            font-family: 'Manrope', -apple-system, sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 60px;
            position: relative;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 4px;
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple));
            border-radius: 2px;
        }

        .header h1 {
            font-size: 48px;
            font-weight: 800;
            margin: 20px 0 15px;
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-purple) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            font-size: 18px;
            color: var(--text-secondary);
            font-weight: 400;
        }

        .upload-section {
            background: var(--bg-card);
            border: 2px dashed var(--border);
            border-radius: 16px;
            padding: 60px 40px;
            text-align: center;
            margin-bottom: 40px;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .upload-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-purple) 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .upload-section:hover::before {
            opacity: 0.05;
        }

        .upload-section.dragover {
            border-color: var(--accent-blue);
            background: var(--bg-elevated);
        }

        .upload-content {
            position: relative;
            z-index: 1;
        }

        .upload-icon {
            font-size: 64px;
            margin-bottom: 20px;
            display: inline-block;
        }

        .upload-section h2 {
            font-size: 24px;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .upload-section p {
            color: var(--text-secondary);
            margin-bottom: 20px;
        }

        .file-types {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
        }

        .file-type-badge {
            background: var(--bg-elevated);
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            border: 1px solid var(--border);
        }

        .file-type-badge code {
            font-family: 'JetBrains Mono', monospace;
            color: var(--accent-blue);
        }

        #fileInput {
            display: none;
        }

        .btn {
            padding: 14px 32px;
            font-size: 16px;
            font-weight: 700;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Manrope', sans-serif;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-purple) 100%);
            color: white;
            box-shadow: 0 4px 20px rgba(77, 171, 247, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 30px rgba(77, 171, 247, 0.5);
        }

        .btn-secondary {
            background: var(--bg-elevated);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--bg-card);
        }

        .action-section {
            margin-bottom: 30px;
        }

        .progress-section {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 40px;
            display: none;
        }

        .progress-section.show {
            display: block;
        }

        .progress-bar-container {
            background: var(--bg-elevated);
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple));
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 4px;
        }

        .progress-text {
            color: var(--text-secondary);
            font-size: 14px;
            text-align: center;
        }

        .results-section {
            display: none;
        }

        .results-section.show {
            display: block;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .summary-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 30px;
            border: 1px solid var(--border);
            position: relative;
            overflow: hidden;
        }

        .summary-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
        }

        .summary-card.safe::before {
            background: var(--success);
        }

        .summary-card.warning::before {
            background: var(--warning);
        }

        .summary-card.error::before {
            background: var(--error);
        }

        .summary-card.info::before {
            background: var(--accent-blue);
        }

        .summary-value {
            font-size: 48px;
            font-weight: 800;
            margin-bottom: 8px;
            line-height: 1;
        }

        .summary-card.safe .summary-value {
            color: var(--success);
        }

        .summary-card.warning .summary-value {
            color: var(--warning);
        }

        .summary-card.error .summary-value {
            color: var(--error);
        }

        .summary-card.info .summary-value {
            color: var(--accent-blue);
        }

        .summary-label {
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .issues-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .issue-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 24px;
            border-left: 4px solid;
            border-color: var(--border);
        }

        .issue-card.error {
            border-color: var(--error);
        }

        .issue-card.warning {
            border-color: var(--warning);
        }

        .issue-card.info {
            border-color: var(--accent-blue);
        }

        .issue-header {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin-bottom: 16px;
        }

        .issue-badge {
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            white-space: nowrap;
        }

        .issue-badge.error {
            background: rgba(220, 20, 60, 0.2);
            color: var(--error);
        }

        .issue-badge.warning {
            background: rgba(255, 140, 0, 0.2);
            color: var(--warning);
        }

        .issue-badge.info {
            background: rgba(77, 171, 247, 0.2);
            color: var(--accent-blue);
        }

        .issue-title {
            font-size: 18px;
            font-weight: 700;
            flex: 1;
        }

        .issue-description {
            color: var(--text-secondary);
            margin-bottom: 16px;
            line-height: 1.7;
        }

        .issue-location {
            background: var(--bg-elevated);
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 12px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 13px;
            border: 1px solid var(--border);
        }

        .issue-code {
            background: var(--bg-elevated);
            padding: 16px;
            border-radius: 8px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 13px;
            overflow-x: auto;
            margin: 12px 0;
            border: 1px solid var(--border);
            line-height: 1.5;
        }

        .issue-suggestion {
            background: rgba(0, 168, 107, 0.1);
            padding: 16px;
            border-radius: 8px;
            margin-top: 12px;
            border: 1px solid rgba(0, 168, 107, 0.3);
        }

        .issue-suggestion strong {
            color: var(--success);
            display: block;
            margin-bottom: 8px;
        }

        .fix-query {
            background: rgba(77, 171, 247, 0.1);
            padding: 16px;
            border-radius: 8px;
            margin-top: 16px;
            border: 1px solid rgba(77, 171, 247, 0.3);
        }

        .fix-query-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .fix-query-header strong {
            color: var(--accent-blue);
            font-size: 14px;
        }

        .btn-copy {
            background: var(--bg-elevated);
            color: var(--text-primary);
            border: 1px solid var(--border);
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-family: 'Manrope', sans-serif;
        }

        .btn-copy:hover {
            background: var(--accent-blue);
            color: white;
            border-color: var(--accent-blue);
        }

        .btn-copy.copied {
            background: var(--success);
            color: white;
            border-color: var(--success);
        }

        .fix-query-code {
            background: var(--bg-elevated);
            padding: 12px;
            border-radius: 6px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 13px;
            overflow-x: auto;
            margin: 0;
            border: 1px solid var(--border);
            line-height: 1.6;
            white-space: pre-wrap;
            word-break: break-all;
        }

        .data-sample {
            margin-top: 12px;
            padding: 12px;
            background: var(--bg-elevated);
            border-radius: 6px;
            border: 1px solid var(--border);
        }

        .data-sample-title {
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 14px;
            color: var(--text-secondary);
        }

        .data-sample-content {
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            color: var(--text-primary);
            overflow-x: auto;
        }

        .no-issues {
            text-align: center;
            padding: 80px 40px;
        }

        .no-issues-icon {
            font-size: 80px;
            margin-bottom: 20px;
        }

        .no-issues h3 {
            font-size: 28px;
            color: var(--success);
            margin-bottom: 12px;
            font-weight: 800;
        }

        .no-issues p {
            color: var(--text-secondary);
            font-size: 16px;
        }

        .export-section {
            margin-top: 40px;
            text-align: center;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 32px;
            }
            
            .file-types {
                flex-direction: column;
                gap: 10px;
            }
            
            .controls {
                flex-direction: column;
            }
            
            .summary-grid {
                grid-template-columns: 1fr;
            }
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>MySQL 8.0 ‚Üí 8.4 ÏóÖÍ∑∏Î†àÏù¥Îìú Í≤ÄÏ¶ùÍ∏∞</h1>
            <p>mysqlsh dump Ìè¥ÎçîÎ•º ÏÑ†ÌÉùÌïòÏó¨ Ìò∏ÌôòÏÑ± Î¨∏Ï†úÎ•º ÏÇ¨Ï†ÑÏóê Î∞úÍ≤¨ÌïòÏÑ∏Ïöî</p>
        </div>

        <div class="upload-section" id="uploadSection">
            <div class="upload-content">
                <div class="upload-icon">üìÅ</div>
                <h2>mysqlsh dump Ìè¥ÎçîÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</h2>
                <p>Ìè¥Îçî Ï†ÑÏ≤¥Î•º ÏÑ†ÌÉùÌïòÎ©¥ ÏûêÎèôÏúºÎ°ú Î∂ÑÏÑùÌï† ÌååÏùºÎì§ÏùÑ Í∞êÏßÄÌï©ÎãàÎã§</p>
                <button class="btn btn-primary" onclick="selectFolder()" style="margin-top: 20px;">
                    üìÅ Ìè¥Îçî ÏÑ†ÌÉù
                </button>
            </div>
        </div>

        <div class="action-section" id="actionSection" style="display: none;">
            <div style="background: var(--bg-card); border-radius: 12px; padding: 30px; margin-bottom: 40px;">
                <h3 style="margin-bottom: 20px; font-size: 18px;">ÏÑ†ÌÉùÎêú Ìè¥Îçî: <span id="folderName" style="color: var(--accent-blue);"></span></h3>
                <div style="color: var(--text-secondary); margin-bottom: 20px;">
                    Ï¥ù <span id="totalFiles" style="color: var(--text-primary); font-weight: 600;">0</span>Í∞ú ÌååÏùº
                    (<span id="schemaFiles">0</span> Ïä§ÌÇ§Îßà, <span id="dataFiles">0</span> Îç∞Ïù¥ÌÑ∞, <span id="skipFiles">0</span> Í±¥ÎÑàÎõ∏ ÌååÏùº)
                </div>
                <div style="display: flex; gap: 15px; justify-content: center;">
                    <button class="btn btn-primary" onclick="analyzeFiles()">
                        üîç Î∂ÑÏÑù ÏãúÏûë
                    </button>
                    <button class="btn btn-secondary" onclick="resetAll()">
                        üîÑ Ï¥àÍ∏∞Ìôî (Ìè¥Îçî Î≥ÄÍ≤Ω)
                    </button>
                </div>
            </div>
        </div>

        <div class="progress-section" id="progressSection">
            <h3>Î∂ÑÏÑù Ï§ë...</h3>
            <div class="progress-bar-container">
                <div class="progress-bar" id="progressBar"></div>
            </div>
            <p class="progress-text" id="progressText">ÌååÏùºÏùÑ ÏùΩÎäî Ï§ë...</p>
        </div>

        <div class="results-section" id="resultsSection">
            <div class="summary-grid">
                <div class="summary-card safe">
                    <div class="summary-value" id="safeCount">0</div>
                    <div class="summary-label">Î¨∏Ï†ú ÏóÜÏùå</div>
                </div>
                <div class="summary-card error">
                    <div class="summary-value" id="errorCount">0</div>
                    <div class="summary-label">Ïã¨Í∞ÅÌïú Î¨∏Ï†ú</div>
                </div>
                <div class="summary-card warning">
                    <div class="summary-value" id="warningCount">0</div>
                    <div class="summary-label">Í≤ΩÍ≥†</div>
                </div>
                <div class="summary-card info">
                    <div class="summary-value" id="infoCount">0</div>
                    <div class="summary-label">Ï†ïÎ≥¥</div>
                </div>
            </div>

            <div class="issues-container" id="issuesContainer"></div>

            <div class="export-section">
                <button class="btn btn-secondary" onclick="exportReport()">
                    üìÑ Î¶¨Ìè¨Ìä∏ Îã§Ïö¥Î°úÎìú (JSON)
                </button>
                <button class="btn btn-primary" onclick="exportAllFixQueries()" style="margin-left: 15px;">
                    üîß Î™®Îì† ÏàòÏ†ï ÏøºÎ¶¨ Îã§Ïö¥Î°úÎìú (SQL)
                </button>
            </div>
        </div>
    </div>

    <script>
        let uploadedFiles = [];
        let analysisResults = {
            issues: [],
            stats: { safe: 0, error: 0, warning: 0, info: 0 }
        };

        // Ìò∏ÌôòÏÑ± Í≤ÄÏÇ¨ Í∑úÏπô
        const compatibilityRules = [
            // Ïä§ÌÇ§Îßà Ìò∏ÌôòÏÑ±
            {
                id: 'utf8_charset',
                type: 'schema',
                pattern: /CHARSET\s*=\s*utf8(?!\w|mb4)/gi,
                severity: 'warning',
                title: 'utf8 Î¨∏ÏûêÏÖã ÏÇ¨Ïö© (utf8mb3)',
                description: 'MySQL 8.4ÏóêÏÑú utf8ÏùÄ utf8mb4Î•º Í∞ÄÎ¶¨ÌÇµÎãàÎã§. Î™ÖÏãúÏ†ÅÏúºÎ°ú utf8mb4Î•º ÏÇ¨Ïö©ÌïòÎäî Í≤ÉÏù¥ Í∂åÏû•Îê©ÎãàÎã§.',
                suggestion: 'CHARSET=utf8ÏùÑ CHARSET=utf8mb4Î°ú Î≥ÄÍ≤ΩÌïòÏÑ∏Ïöî.',
                generateFixQuery: (context) => {
                    const tableMatch = context.code.match(/CREATE TABLE\s+`?(\w+)`?/i);
                    if (tableMatch) {
                        return `ALTER TABLE \`${tableMatch[1]}\` CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;`;
                    }
                    return null;
                }
            },
            {
                id: 'myisam_engine',
                type: 'schema',
                pattern: /ENGINE\s*=\s*MyISAM/gi,
                severity: 'warning',
                title: 'MyISAM ÏóîÏßÑ ÏÇ¨Ïö©',
                description: 'InnoDB ÏÇ¨Ïö©Ïù¥ Í∞ïÎ†•Ìûà Í∂åÏû•Îê©ÎãàÎã§.',
                suggestion: 'ENGINE=InnoDBÎ°ú Î≥ÄÍ≤ΩÏùÑ Í≥†Î†§ÌïòÏÑ∏Ïöî.',
                generateFixQuery: (context) => {
                    const tableMatch = context.code.match(/CREATE TABLE\s+`?(\w+)`?/i);
                    if (tableMatch) {
                        return `ALTER TABLE \`${tableMatch[1]}\` ENGINE=InnoDB;`;
                    }
                    return null;
                }
            },
            {
                id: 'year2',
                type: 'schema',
                pattern: /YEAR\(2\)/gi,
                severity: 'error',
                title: 'YEAR(2) Îç∞Ïù¥ÌÑ∞ ÌÉÄÏûÖ',
                description: 'YEAR(2)Îäî deprecatedÎêòÏóàÏúºÎ©∞ YEAR(4)Î°ú ÏûêÎèô Î≥ÄÌôòÎê©ÎãàÎã§.',
                suggestion: 'YEAR(2)Î•º YEAR ÎòêÎäî YEAR(4)Î°ú Î≥ÄÍ≤ΩÌïòÏÑ∏Ïöî.',
                generateFixQuery: (context) => {
                    const tableMatch = context.code.match(/CREATE TABLE\s+`?(\w+)`?/i);
                    const columnMatch = context.code.match(/`?(\w+)`?\s+YEAR\(2\)/i);
                    if (tableMatch && columnMatch) {
                        return `ALTER TABLE \`${tableMatch[1]}\` MODIFY COLUMN \`${columnMatch[1]}\` YEAR;`;
                    }
                    return null;
                }
            },
            {
                id: 'zerofill',
                type: 'schema',
                pattern: /`?(\w+)`?\s+\w+\s+ZEROFILL/gi,
                severity: 'warning',
                title: 'ZEROFILL ÏÜçÏÑ± ÏÇ¨Ïö©',
                description: 'ZEROFILLÏùÄ MySQL 8.0.17Î∂ÄÌÑ∞ deprecatedÎêòÏóàÏäµÎãàÎã§.',
                suggestion: 'Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖò Î†àÎ≤®ÏóêÏÑú Ï†úÎ°ú Ìå®Îî©ÏùÑ Ï≤òÎ¶¨ÌïòÏÑ∏Ïöî.',
                generateFixQuery: (context) => {
                    const tableMatch = context.code.match(/CREATE TABLE\s+`?(\w+)`?/i);
                    const columnMatch = context.code.match(/`?(\w+)`?\s+(\w+)\s+ZEROFILL/i);
                    if (tableMatch && columnMatch) {
                        return `ALTER TABLE \`${tableMatch[1]}\` MODIFY COLUMN \`${columnMatch[1]}\` ${columnMatch[2]};`;
                    }
                    return null;
                }
            },
            {
                id: 'float_precision',
                type: 'schema',
                pattern: /FLOAT\(\d+,\d+\)|DOUBLE\(\d+,\d+\)/gi,
                severity: 'warning',
                title: 'FLOAT/DOUBLE Ï†ïÎ∞ÄÎèÑ Î™ÖÏãú',
                description: 'FLOAT(M,D) Î∞è DOUBLE(M,D) ÌòïÏãùÏùÄ deprecatedÎêòÏóàÏäµÎãàÎã§.',
                suggestion: 'DECIMAL ÌÉÄÏûÖ ÏÇ¨Ïö©ÏùÑ Í∂åÏû•Ìï©ÎãàÎã§.',
                generateFixQuery: (context) => {
                    const tableMatch = context.code.match(/CREATE TABLE\s+`?(\w+)`?/i);
                    const columnMatch = context.code.match(/`?(\w+)`?\s+(FLOAT|DOUBLE)\((\d+),(\d+)\)/i);
                    if (tableMatch && columnMatch) {
                        return `ALTER TABLE \`${tableMatch[1]}\` MODIFY COLUMN \`${columnMatch[1]}\` DECIMAL(${columnMatch[3]},${columnMatch[4]});`;
                    }
                    return null;
                }
            },
            {
                id: 'latin1',
                type: 'schema',
                pattern: /CHARSET\s*=\s*latin1/gi,
                severity: 'warning',
                title: 'latin1 Î¨∏ÏûêÏÖã ÏÇ¨Ïö©',
                description: 'MySQL 8.4Ïùò Í∏∞Î≥∏ Î¨∏ÏûêÏÖãÏùÄ utf8mb4ÏûÖÎãàÎã§.',
                suggestion: 'utf8mb4Î°ú Î≥ÄÍ≤ΩÏùÑ Í≥†Î†§ÌïòÏÑ∏Ïöî.',
                generateFixQuery: (context) => {
                    const tableMatch = context.code.match(/CREATE TABLE\s+`?(\w+)`?/i);
                    if (tableMatch) {
                        return `ALTER TABLE \`${tableMatch[1]}\` CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;`;
                    }
                    return null;
                }
            },
            {
                id: 'sql_calc_found_rows',
                type: 'query',
                pattern: /SQL_CALC_FOUND_ROWS/gi,
                severity: 'warning',
                title: 'SQL_CALC_FOUND_ROWS ÏÇ¨Ïö©',
                description: 'SQL_CALC_FOUND_ROWSÎäî MySQL 8.0.17Î∂ÄÌÑ∞ deprecatedÎêòÏóàÏäµÎãàÎã§.',
                suggestion: 'Îëê Í∞úÏùò ÏøºÎ¶¨Î°ú Î∂ÑÎ¶¨ÌïòÍ±∞ÎÇò Îã§Î•∏ Î∞©Î≤ïÏùÑ ÏÇ¨Ïö©ÌïòÏÑ∏Ïöî.'
            },
            {
                id: 'int_display_width',
                type: 'schema',
                pattern: /INT\(\d+\)(?!\s+ZEROFILL)/gi,
                severity: 'info',
                title: 'INTEGER display width',
                description: 'MySQL 8.0.17Î∂ÄÌÑ∞ Ï†ïÏàòÌòïÏùò display widthÎäî deprecatedÎêòÏóàÏäµÎãàÎã§.',
                suggestion: 'INT(11) ÎåÄÏã† INTÎ•º ÏÇ¨Ïö©ÌïòÏÑ∏Ïöî.'
            },
            
            // Îç∞Ïù¥ÌÑ∞ Î¨¥Í≤∞ÏÑ± Î¨∏Ï†ú
            {
                id: 'invalid_date_zero',
                type: 'data',
                severity: 'error',
                title: 'ÏûòÎ™ªÎêú ÎÇ†Ïßú Í∞í: 0000-00-00',
                description: 'MySQL 8.0Î∂ÄÌÑ∞ NO_ZERO_DATE SQL Î™®ÎìúÍ∞Ä Í∏∞Î≥∏ ÌôúÏÑ±ÌôîÎêòÏñ¥ 0000-00-00 ÎÇ†ÏßúÎ•º ÌóàÏö©ÌïòÏßÄ ÏïäÏäµÎãàÎã§.',
                suggestion: 'NULL ÎòêÎäî Ïú†Ìö®Ìïú ÎÇ†ÏßúÎ°ú Î≥ÄÍ≤ΩÌï¥Ïïº Ìï©ÎãàÎã§.',
                detectInData: (value) => {
                    return /['"]0000-00-00/.test(value);
                },
                generateFixQuery: (context) => {
                    if (context.tableName && context.columnName) {
                        return [
                            `-- 0000-00-00 Í∞íÏùÑ NULLÎ°ú Î≥ÄÍ≤Ω`,
                            `UPDATE \`${context.tableName}\` SET \`${context.columnName}\` = NULL WHERE \`${context.columnName}\` = '0000-00-00';`,
                            ``,
                            `-- ÎòêÎäî ÌäπÏ†ï ÎÇ†ÏßúÎ°ú Î≥ÄÍ≤Ω (Ïòà: 1970-01-01)`,
                            `-- UPDATE \`${context.tableName}\` SET \`${context.columnName}\` = '1970-01-01' WHERE \`${context.columnName}\` = '0000-00-00';`
                        ].join('\n');
                    }
                    return null;
                }
            },
            {
                id: 'invalid_datetime_zero',
                type: 'data',
                severity: 'error',
                title: 'ÏûòÎ™ªÎêú ÎÇ†ÏßúÏãúÍ∞Ñ Í∞í: 0000-00-00 00:00:00',
                description: 'MySQL 8.0Î∂ÄÌÑ∞ NO_ZERO_DATE SQL Î™®ÎìúÍ∞Ä Í∏∞Î≥∏ ÌôúÏÑ±ÌôîÎêòÏñ¥ 0000-00-00 00:00:00ÏùÑ ÌóàÏö©ÌïòÏßÄ ÏïäÏäµÎãàÎã§.',
                suggestion: 'NULL ÎòêÎäî Ïú†Ìö®Ìïú ÎÇ†ÏßúÏãúÍ∞ÑÏúºÎ°ú Î≥ÄÍ≤ΩÌï¥Ïïº Ìï©ÎãàÎã§.',
                detectInData: (value) => {
                    return /['"]0000-00-00 00:00:00/.test(value);
                },
                generateFixQuery: (context) => {
                    if (context.tableName && context.columnName) {
                        return [
                            `-- 0000-00-00 00:00:00 Í∞íÏùÑ NULLÎ°ú Î≥ÄÍ≤Ω`,
                            `UPDATE \`${context.tableName}\` SET \`${context.columnName}\` = NULL WHERE \`${context.columnName}\` = '0000-00-00 00:00:00';`,
                            ``,
                            `-- ÎòêÎäî ÌäπÏ†ï ÎÇ†ÏßúÏãúÍ∞ÑÏúºÎ°ú Î≥ÄÍ≤Ω (Ïòà: 1970-01-01 00:00:00)`,
                            `-- UPDATE \`${context.tableName}\` SET \`${context.columnName}\` = '1970-01-01 00:00:00' WHERE \`${context.columnName}\` = '0000-00-00 00:00:00';`
                        ].join('\n');
                    }
                    return null;
                }
            },
            {
                id: 'enum_empty_value',
                type: 'data',
                severity: 'error',
                title: 'ENUM Ïª¨ÎüºÏóê Îπà Í∞í',
                description: 'ENUM Ïª¨ÎüºÏóê Îπà Î¨∏ÏûêÏó¥Ïù¥ Ï†ÄÏû•ÎêòÏñ¥ ÏûàÏäµÎãàÎã§. strict Î™®ÎìúÏóêÏÑú Î¨∏Ï†úÍ∞Ä Îê† Ïàò ÏûàÏäµÎãàÎã§.',
                suggestion: 'ENUMÏóê Ï†ïÏùòÎêú Ïú†Ìö®Ìïú Í∞íÏúºÎ°ú Î≥ÄÍ≤ΩÌïòÍ±∞ÎÇò NULLÏùÑ ÌóàÏö©ÌïòÎèÑÎ°ù Ïä§ÌÇ§ÎßàÎ•º ÏàòÏ†ïÌïòÏÑ∏Ïöî.',
                detectInData: (value, columnType) => {
                    return /ENUM/i.test(columnType) && /[,\(]['"]['"]/i.test(value);
                },
                generateFixQuery: (context) => {
                    if (context.tableName && context.columnName && context.enumValues) {
                        const firstValue = context.enumValues[0] || 'default';
                        return [
                            `-- ENUM Ïª¨ÎüºÏùò Îπà Í∞íÏùÑ Ï≤´ Î≤àÏß∏ ENUM Í∞íÏúºÎ°ú Î≥ÄÍ≤Ω`,
                            `UPDATE \`${context.tableName}\` SET \`${context.columnName}\` = '${firstValue}' WHERE \`${context.columnName}\` = '';`,
                            ``,
                            `-- ÎòêÎäî NULLÏùÑ ÌóàÏö©ÌïòÎèÑÎ°ù Ïª¨Îüº ÏàòÏ†ï`,
                            `-- ALTER TABLE \`${context.tableName}\` MODIFY COLUMN \`${context.columnName}\` ${context.columnType} NULL;`,
                            `-- UPDATE \`${context.tableName}\` SET \`${context.columnName}\` = NULL WHERE \`${context.columnName}\` = '';`
                        ].join('\n');
                    }
                    return null;
                }
            },
            {
                id: 'enum_numeric_index',
                type: 'data',
                severity: 'warning',
                title: 'ENUM Ïà´Ïûê Ïù∏Îç±Ïä§ ÏÇ¨Ïö©',
                description: 'ENUM Í∞íÏùÑ Ïà´ÏûêÎ°ú Ï†ÄÏû•ÌïòÎ©¥ ENUM Ï†ïÏùò ÏàúÏÑú Î≥ÄÍ≤Ω Ïãú Îç∞Ïù¥ÌÑ∞Í∞Ä ÏûòÎ™ª Ìï¥ÏÑùÎê† Ïàò ÏûàÏäµÎãàÎã§.',
                suggestion: 'ENUM Í∞íÏùÄ Î¨∏ÏûêÏó¥Î°ú Ï†ÄÏû•ÌïòÎäî Í≤ÉÏù¥ ÏïàÏ†ÑÌï©ÎãàÎã§.',
                detectInData: (value, columnType) => {
                    return /ENUM/i.test(columnType) && /[,\(]\d+[,\)]/i.test(value);
                }
            },
            {
                id: 'data_4byte_chars',
                type: 'data',
                severity: 'warning',
                title: '4Î∞îÏù¥Ìä∏ UTF-8 Î¨∏Ïûê Î∞úÍ≤¨',
                description: 'utf8mb3 Î¨∏ÏûêÏÖãÏúºÎ°úÎäî Ï†ÄÏû•Ìï† Ïàò ÏóÜÎäî Ïù¥Î™®ÏßÄ ÎòêÎäî 4Î∞îÏù¥Ìä∏ UTF-8 Î¨∏ÏûêÍ∞Ä Ìè¨Ìï®ÎêòÏñ¥ ÏûàÏäµÎãàÎã§.',
                suggestion: 'ÌÖåÏù¥Î∏î Î¨∏ÏûêÏÖãÏùÑ utf8mb4Î°ú Î≥ÄÍ≤ΩÌï¥Ïïº Ìï©ÎãàÎã§.',
                generateFixQuery: (context) => {
                    if (context.tableName) {
                        return `ALTER TABLE \`${context.tableName}\` CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;`;
                    }
                    return null;
                }
            },
            {
                id: 'data_null_byte',
                type: 'data',
                severity: 'error',
                title: 'NULL Î∞îÏù¥Ìä∏ Î∞úÍ≤¨',
                description: 'Îç∞Ïù¥ÌÑ∞Ïóê NULL Î∞îÏù¥Ìä∏(\\0)Í∞Ä Ìè¨Ìï®ÎêòÏñ¥ ÏûàÏäµÎãàÎã§.',
                suggestion: 'NULL Î∞îÏù¥Ìä∏Î•º Ï†úÍ±∞ÌïòÍ±∞ÎÇò BLOB ÌÉÄÏûÖ ÏÇ¨Ïö©ÏùÑ Í≥†Î†§ÌïòÏÑ∏Ïöî.',
                generateFixQuery: (context) => {
                    if (context.tableName && context.columnName) {
                        return `UPDATE \`${context.tableName}\` SET \`${context.columnName}\` = REPLACE(\`${context.columnName}\`, CHAR(0), '') WHERE \`${context.columnName}\` LIKE '%' + CHAR(0) + '%';`;
                    }
                    return null;
                }
            },
            {
                id: 'timestamp_out_of_range',
                type: 'data',
                severity: 'error',
                title: 'TIMESTAMP Î≤îÏúÑ Ï¥àÍ≥º',
                description: 'TIMESTAMPÎäî 1970-01-01 00:00:01 ~ 2038-01-19 03:14:07 Î≤îÏúÑÎßå ÏßÄÏõêÌï©ÎãàÎã§.',
                suggestion: 'DATETIME ÌÉÄÏûÖÏúºÎ°ú Î≥ÄÍ≤ΩÏùÑ Í≥†Î†§ÌïòÏÑ∏Ïöî.',
                detectInData: (value, columnType) => {
                    if (!/TIMESTAMP/i.test(columnType)) return false;
                    const match = value.match(/['"](\d{4}-\d{2}-\d{2})/);
                    if (match) {
                        const year = parseInt(match[1].split('-')[0]);
                        return year < 1970 || year > 2038;
                    }
                    return false;
                },
                generateFixQuery: (context) => {
                    if (context.tableName && context.columnName) {
                        return `ALTER TABLE \`${context.tableName}\` MODIFY COLUMN \`${context.columnName}\` DATETIME;`;
                    }
                    return null;
                }
            }
        ];

        // ÌååÏùº ÏóÖÎ°úÎìú ÏòÅÏó≠ ÏÑ§Ï†ï
        const uploadSection = document.getElementById('uploadSection');
        
        // Ìè¥Îçî ÏÑ†ÌÉùÏùÑ ÏúÑÌïú Ïà®Í≤®ÏßÑ input ÏÉùÏÑ±
        const folderInput = document.createElement('input');
        folderInput.type = 'file';
        folderInput.webkitdirectory = true;
        folderInput.directory = true;
        folderInput.multiple = true;
        folderInput.style.display = 'none';
        document.body.appendChild(folderInput);
        
        function selectFolder() {
            folderInput.click();
        }
        
        folderInput.addEventListener('change', (e) => {
            handleFiles(e.target.files);
        });

        function handleFiles(files) {
            const fileArray = Array.from(files);
            
            if (fileArray.length === 0) return;
            
            uploadedFiles = []; // Ï¥àÍ∏∞Ìôî
            
            // Ìè¥ÎçîÎ™Ö Ï∂îÏ∂ú (Ï≤´ Î≤àÏß∏ ÌååÏùºÏùò Í≤ΩÎ°úÏóêÏÑú)
            const firstFile = fileArray[0];
            const folderPath = firstFile.webkitRelativePath || firstFile.name;
            const folderName = folderPath.split('/')[0] || 'Ïïå Ïàò ÏóÜÏùå';
            
            fileArray.forEach(file => {
                const filePath = file.webkitRelativePath || file.name;
                uploadedFiles.push(file);
            });

            // ÌååÏùº ÌÜµÍ≥Ñ Í≥ÑÏÇ∞
            const stats = {
                total: uploadedFiles.length,
                schema: 0,
                data: 0,
                skip: 0
            };
            
            uploadedFiles.forEach(file => {
                const fileType = detectFileType(file.name);
                if (fileType === 'schema') stats.schema++;
                else if (fileType === 'data') stats.data++;
                else if (fileType === 'skip') stats.skip++;
            });

            // UI ÏóÖÎç∞Ïù¥Ìä∏
            document.getElementById('folderName').textContent = folderName;
            document.getElementById('totalFiles').textContent = stats.total;
            document.getElementById('schemaFiles').textContent = stats.schema;
            document.getElementById('dataFiles').textContent = stats.data;
            document.getElementById('skipFiles').textContent = stats.skip;
            
            // ÏóÖÎ°úÎìú ÏÑπÏÖò Ïà®Í∏∞Í≥† Ïï°ÏÖò ÏÑπÏÖò ÌëúÏãú
            uploadSection.style.display = 'none';
            document.getElementById('actionSection').style.display = 'block';
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
        }

        async function analyzeFiles() {
            const progressSection = document.getElementById('progressSection');
            const resultsSection = document.getElementById('resultsSection');
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');

            // Ï¥àÍ∏∞Ìôî
            analysisResults = {
                issues: [],
                stats: { safe: 0, error: 0, warning: 0, info: 0 },
                metadata: {
                    totalFiles: uploadedFiles.length,
                    analyzedAt: new Date().toISOString()
                }
            };

            progressSection.classList.add('show');
            resultsSection.classList.remove('show');

            let processedFiles = 0;

            for (const file of uploadedFiles) {
                processedFiles++;
                const progress = (processedFiles / uploadedFiles.length) * 100;
                progressBar.style.width = progress + '%';
                
                // ÌååÏùº ÌÉÄÏûÖ Í∞êÏßÄ
                const fileType = detectFileType(file.name);
                progressText.textContent = `${file.name} ${fileType === 'skip' ? 'Í±¥ÎÑàÎõ∞Îäî Ï§ë' : 'Î∂ÑÏÑù Ï§ë'}... (${processedFiles}/${uploadedFiles.length})`;

                await analyzeFile(file);
                
                // UI ÏóÖÎç∞Ïù¥Ìä∏Î•º ÏúÑÌïú ÏûëÏùÄ ÎîúÎ†àÏù¥
                await new Promise(resolve => setTimeout(resolve, 50));
            }

            progressText.textContent = 'Î∂ÑÏÑù ÏôÑÎ£å!';
            
            setTimeout(() => {
                progressSection.classList.remove('show');
                displayResults();
            }, 500);
        }

        async function analyzeFile(file) {
            const content = await readFileContent(file);
            const fileName = file.name;

            // mysqlsh dump ÏßÑÌñâ ÏÉÅÌô© ÌååÏùº Í±¥ÎÑàÎõ∞Í∏∞ (Î∂ÑÏÑù Î∂àÌïÑÏöî)
            if (fileName.startsWith('load-progress') || 
                fileName.startsWith('dump-progress') ||
                fileName === '@.done.json') {
                console.log(`Skipping progress file: ${fileName}`);
                return;
            }

            // mysqlsh dump Î©îÌÉÄÎç∞Ïù¥ÌÑ∞ ÌååÏùº Ï≤òÎ¶¨
            if (fileName.endsWith('.json') && fileName.includes('@.')) {
                await analyzeMysqlShellMetadata(content, fileName);
                return;
            }

            // SQL ÌååÏùº Î∂ÑÏÑù
            if (fileName.endsWith('.sql')) {
                await analyzeSQLFile(content, fileName);
                return;
            }

            // TSV ÌååÏùº (mysqlsh data dump)
            if (fileName.endsWith('.tsv') || fileName.endsWith('.txt')) {
                await analyzeTSVData(content, fileName);
                return;
            }
            
            // Ïù∏ÏãùÌï† Ïàò ÏóÜÎäî ÌååÏùº ÌòïÏãù
            console.log(`Skipping unknown file type: ${fileName}`);
        }

        function readFileContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => resolve(e.target.result);
                reader.onerror = reject;
                reader.readAsText(file);
            });
        }

        function detectFileType(fileName) {
            // Í±¥ÎÑàÎõ∏ ÌååÏùºÎì§
            if (fileName.startsWith('load-progress') || 
                fileName.startsWith('dump-progress') ||
                fileName === '@.done.json') {
                return 'skip';
            }
            
            // Î∂ÑÏÑùÌï† ÌååÏùºÎì§
            if (fileName.endsWith('.sql')) return 'schema';
            if (fileName.endsWith('.json') && fileName.includes('@.')) return 'metadata';
            if (fileName.endsWith('.tsv')) return 'data';
            if (fileName.endsWith('.txt')) return 'data';
            
            return 'unknown';
        }

        async function analyzeMysqlShellMetadata(content, fileName) {
            try {
                const metadata = JSON.parse(content);
                
                // ÌÖåÏù¥Î∏î Î©îÌÉÄÎç∞Ïù¥ÌÑ∞ÏóêÏÑú Ïä§ÌÇ§Îßà Ï†ïÎ≥¥ Ï∂îÏ∂ú
                if (metadata.options && metadata.options.defaultCharacterSet) {
                    const charset = metadata.options.defaultCharacterSet;
                    if (charset === 'utf8' || charset === 'utf8mb3') {
                        addIssue({
                            ...findRuleById('utf8_charset'),
                            location: fileName,
                            code: `defaultCharacterSet: "${charset}"`,
                        });
                    }
                }
            } catch (e) {
                console.error('Error parsing metadata:', e);
            }
        }

        async function analyzeSQLFile(content, fileName) {
            // Ïä§ÌÇ§Îßà Í≤ÄÏÇ¨
            compatibilityRules.filter(rule => rule.type === 'schema' || rule.type === 'query').forEach(rule => {
                const matches = content.matchAll(rule.pattern);
                const seen = new Set();

                for (const match of matches) {
                    const context = extractContext(content, match.index, 300);
                    const key = `${rule.id}-${context}`;
                    
                    if (!seen.has(key)) {
                        seen.add(key);
                        
                        const issue = {
                            ...rule,
                            location: fileName,
                            code: context,
                            matchedText: match[0]
                        };
                        
                        // ÏàòÏ†ï ÏøºÎ¶¨ ÏÉùÏÑ±
                        if (rule.generateFixQuery) {
                            issue.fixQuery = rule.generateFixQuery({ code: context });
                        }
                        
                        addIssue(issue);
                    }
                }
            });

            // INSERT Î¨∏ÏóêÏÑú Îç∞Ïù¥ÌÑ∞ Í≤ÄÏÇ¨
            analyzeInsertStatements(content, fileName);
        }

        function analyzeInsertStatements(content, fileName) {
            // ÌÖåÏù¥Î∏î Ïä§ÌÇ§Îßà Ï†ïÎ≥¥ Ï∂îÏ∂ú
            const tableSchemas = extractTableSchemas(content);
            
            // INSERT Î¨∏ ÌååÏã±
            const insertPattern = /INSERT INTO\s+`?(\w+)`?\s+(?:\(([^)]+)\)\s+)?VALUES\s*(\([^;]+\));?/gi;
            const matches = content.matchAll(insertPattern);

            for (const match of matches) {
                const tableName = match[1];
                const columnsStr = match[2];
                const valuesStr = match[3];
                
                const columns = columnsStr ? columnsStr.split(',').map(c => c.trim().replace(/`/g, '')) : [];
                const schema = tableSchemas[tableName] || {};
                
                // 0000-00-00 ÎÇ†Ïßú Í≤ÄÏÇ¨
                if (/['"]0000-00-00(?:\s+00:00:00)?['"]/i.test(valuesStr)) {
                    const dateMatch = valuesStr.match(/['"]0000-00-00(\s+00:00:00)?['"]/i);
                    const isDateTime = dateMatch[1] !== undefined;
                    const rule = compatibilityRules.find(r => 
                        r.id === (isDateTime ? 'invalid_datetime_zero' : 'invalid_date_zero')
                    );
                    
                    // Ïñ¥Îäê Ïª¨ÎüºÏù∏ÏßÄ Ï∂îÏ†ï
                    const columnIndex = estimateColumnIndex(valuesStr, dateMatch[0]);
                    const columnName = columns[columnIndex] || 'unknown';
                    
                    addIssue({
                        ...rule,
                        location: `${fileName} - Table: ${tableName}`,
                        code: valuesStr.substring(0, 200) + '...',
                        tableName: tableName,
                        columnName: columnName,
                        fixQuery: rule.generateFixQuery({ tableName, columnName })
                    });
                }
                
                // ENUM Îπà Í∞í Í≤ÄÏÇ¨
                for (let i = 0; i < columns.length; i++) {
                    const columnName = columns[i];
                    const columnType = schema[columnName];
                    
                    if (columnType && /ENUM/i.test(columnType)) {
                        // Îπà Î¨∏ÏûêÏó¥ Í≤ÄÏÇ¨
                        if (/[,\(]['"]['"]/i.test(valuesStr)) {
                            const rule = compatibilityRules.find(r => r.id === 'enum_empty_value');
                            const enumValues = extractEnumValues(columnType);
                            
                            addIssue({
                                ...rule,
                                location: `${fileName} - Table: ${tableName}, Column: ${columnName}`,
                                code: valuesStr.substring(0, 200) + '...',
                                tableName: tableName,
                                columnName: columnName,
                                columnType: columnType,
                                enumValues: enumValues,
                                fixQuery: rule.generateFixQuery({ 
                                    tableName, 
                                    columnName, 
                                    columnType, 
                                    enumValues 
                                })
                            });
                        }
                    }
                }
                
                // utf8mb4 Î≤îÏúÑÎ•º Î≤óÏñ¥ÎÇòÎäî Î¨∏Ïûê Í≤ÄÏÇ¨
                const has4ByteChars = /[\u{10000}-\u{10FFFF}]/u.test(valuesStr);
                if (has4ByteChars) {
                    const rule = compatibilityRules.find(r => r.id === 'data_4byte_chars');
                    addIssue({
                        ...rule,
                        location: `${fileName} - Table: ${tableName}`,
                        code: valuesStr.substring(0, 200) + '...',
                        tableName: tableName,
                        fixQuery: rule.generateFixQuery({ tableName })
                    });
                }

                // NULL Î∞îÏù¥Ìä∏ Í≤ÄÏÇ¨
                if (valuesStr.includes('\\0') || valuesStr.includes('\x00')) {
                    const rule = compatibilityRules.find(r => r.id === 'data_null_byte');
                    addIssue({
                        ...rule,
                        location: `${fileName} - Table: ${tableName}`,
                        code: valuesStr.substring(0, 200) + '...',
                        tableName: tableName,
                        fixQuery: rule.generateFixQuery({ tableName, columnName: 'affected_column' })
                    });
                }
            }
        }

        function extractTableSchemas(content) {
            const schemas = {};
            const createTablePattern = /CREATE TABLE\s+`?(\w+)`?\s+\(([^;]+)\)/gi;
            const matches = content.matchAll(createTablePattern);
            
            for (const match of matches) {
                const tableName = match[1];
                const columnsStr = match[2];
                schemas[tableName] = {};
                
                // Ïª¨Îüº Ï†ïÏùò ÌååÏã±
                const columnPattern = /`?(\w+)`?\s+(ENUM\([^)]+\)|[A-Z]+(?:\([^)]+\))?)/gi;
                const columnMatches = columnsStr.matchAll(columnPattern);
                
                for (const colMatch of columnMatches) {
                    schemas[tableName][colMatch[1]] = colMatch[2];
                }
            }
            
            return schemas;
        }

        function extractEnumValues(enumType) {
            const match = enumType.match(/ENUM\s*\(([^)]+)\)/i);
            if (match) {
                return match[1].split(',').map(v => v.trim().replace(/^['"]|['"]$/g, ''));
            }
            return [];
        }

        function estimateColumnIndex(valuesStr, targetValue) {
            // Í∞ÑÎã®Ìïú Ï∂îÏ†ï: ÏΩ§ÎßàÎ°ú Î∂ÑÎ¶¨ÌïòÏó¨ Ïù∏Îç±Ïä§ Ï∞æÍ∏∞
            const values = valuesStr.split(',');
            for (let i = 0; i < values.length; i++) {
                if (values[i].includes(targetValue)) {
                    return i;
                }
            }
            return 0;
        }

        async function analyzeTSVData(content, fileName) {
            // TSV ÌååÏùºÏóêÏÑú Îç∞Ïù¥ÌÑ∞ Í≤ÄÏÇ¨
            const lines = content.split('\n');
            const tableName = fileName.replace(/\.tsv$|\.txt$/, '').split('@')[0];

            let lineNum = 0;
            for (const line of lines.slice(0, 1000)) { // Ï≤òÏùå 1000Ï§ÑÎßå Í≤ÄÏÇ¨
                lineNum++;
                
                // 4Î∞îÏù¥Ìä∏ Î¨∏Ïûê Í≤ÄÏÇ¨
                if (/[\u{10000}-\u{10FFFF}]/u.test(line)) {
                    addIssue({
                        id: 'data_4byte_chars',
                        severity: 'warning',
                        title: '4Î∞îÏù¥Ìä∏ UTF-8 Î¨∏Ïûê Î∞úÍ≤¨ (Îç∞Ïù¥ÌÑ∞)',
                        description: `TSV Îç∞Ïù¥ÌÑ∞Ïóê Ïù¥Î™®ÏßÄ ÎòêÎäî 4Î∞îÏù¥Ìä∏ UTF-8 Î¨∏ÏûêÍ∞Ä Ìè¨Ìï®ÎêòÏñ¥ ÏûàÏäµÎãàÎã§.`,
                        suggestion: 'ÌÖåÏù¥Î∏î Î¨∏ÏûêÏÖãÏùÑ utf8mb4Î°ú ÏÑ§Ï†ïÌï¥Ïïº Ìï©ÎãàÎã§.',
                        location: `${fileName}:${lineNum}`,
                        code: line.substring(0, 100) + '...',
                        dataSample: line
                    });
                    break; // Ìïú ÌååÏùºÎãπ Ìïú Î≤àÎßå Î≥¥Í≥†
                }
            }
        }

        function findRuleById(id) {
            return compatibilityRules.find(rule => rule.id === id);
        }

        function addIssue(issue) {
            // Ï§ëÎ≥µ Ï≤¥ÌÅ¨
            const isDuplicate = analysisResults.issues.some(existing => 
                existing.id === issue.id && 
                existing.location === issue.location &&
                existing.code === issue.code
            );

            if (!isDuplicate) {
                analysisResults.issues.push(issue);
                analysisResults.stats[issue.severity]++;
            }
        }

        function extractContext(content, position, length) {
            const start = Math.max(0, position - length / 2);
            const end = Math.min(content.length, position + length / 2);
            let context = content.substring(start, end);
            
            // ÏïûÎí§ Ï§ÑÎ∞îÍøà Ï†ïÎ¶¨
            context = context.trim();
            
            return context;
        }

        function displayResults() {
            const resultsSection = document.getElementById('resultsSection');
            const issuesContainer = document.getElementById('issuesContainer');

            // ÌÜµÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
            document.getElementById('safeCount').textContent = 
                analysisResults.issues.length === 0 ? '‚úì' : '‚Äî';
            document.getElementById('errorCount').textContent = 
                analysisResults.stats.error || 0;
            document.getElementById('warningCount').textContent = 
                analysisResults.stats.warning || 0;
            document.getElementById('infoCount').textContent = 
                analysisResults.stats.info || 0;

            // Ïù¥Ïäà ÌëúÏãú
            if (analysisResults.issues.length === 0) {
                issuesContainer.innerHTML = `
                    <div class="no-issues">
                        <div class="no-issues-icon">‚úÖ</div>
                        <h3>Ìò∏ÌôòÏÑ± Î¨∏Ï†úÍ∞Ä Î∞úÍ≤¨ÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§!</h3>
                        <p>Î∂ÑÏÑùÌïú Îç§ÌîÑ ÌååÏùºÏùÄ MySQL 8.4Î°ú ÏóÖÍ∑∏Î†àÏù¥ÎìúÌïòÎäîÎç∞ Î¨∏Ï†úÍ∞Ä ÏóÜÏñ¥ Î≥¥ÏûÖÎãàÎã§.</p>
                        <p style="margin-top: 12px; font-size: 14px;">
                            (Ï£ºÏöî Ìò∏ÌôòÏÑ± Î¨∏Ï†úÎ•º Í≤ÄÏÇ¨ÌñàÏúºÎ©∞, Ïã§Ï†ú ÌôòÍ≤ΩÏóêÏÑú Ï∂îÍ∞Ä ÌÖåÏä§Ìä∏Î•º Í∂åÏû•Ìï©ÎãàÎã§)
                        </p>
                    </div>
                `;
            } else {
                // Ïã¨Í∞ÅÎèÑÎ≥Ñ Ï†ïÎ†¨
                const sortedIssues = [...analysisResults.issues].sort((a, b) => {
                    const severityOrder = { error: 0, warning: 1, info: 2 };
                    return severityOrder[a.severity] - severityOrder[b.severity];
                });

                issuesContainer.innerHTML = sortedIssues.map(issue => `
                    <div class="issue-card ${issue.severity}">
                        <div class="issue-header">
                            <span class="issue-badge ${issue.severity}">
                                ${issue.severity === 'error' ? 'üö´ ERROR' : 
                                  issue.severity === 'warning' ? '‚ö†Ô∏è WARNING' : 
                                  '‚ÑπÔ∏è INFO'}
                            </span>
                            <div class="issue-title">${issue.title}</div>
                        </div>
                        <div class="issue-description">${issue.description}</div>
                        ${issue.location ? `
                            <div class="issue-location">üìç ÏúÑÏπò: ${issue.location}</div>
                        ` : ''}
                        ${issue.code ? `
                            <div class="issue-code">${escapeHtml(issue.code)}</div>
                        ` : ''}
                        ${issue.dataSample ? `
                            <div class="data-sample">
                                <div class="data-sample-title">Îç∞Ïù¥ÌÑ∞ ÏÉòÌîå:</div>
                                <div class="data-sample-content">${escapeHtml(issue.dataSample.substring(0, 200))}...</div>
                            </div>
                        ` : ''}
                        <div class="issue-suggestion">
                            <strong>üí° Í∂åÏû•ÏÇ¨Ìï≠</strong>
                            ${issue.suggestion}
                        </div>
                        ${issue.fixQuery ? `
                            <div class="fix-query">
                                <div class="fix-query-header">
                                    <strong>üîß Ïã§Ìñâ Í∞ÄÎä•Ìïú ÏàòÏ†ï ÏøºÎ¶¨</strong>
                                    <button class="btn-copy" onclick="copyToClipboard(${JSON.stringify(issue.fixQuery).replace(/"/g, '&quot;')}, this)">
                                        üìã Î≥µÏÇ¨
                                    </button>
                                </div>
                                <pre class="fix-query-code">${escapeHtml(issue.fixQuery)}</pre>
                            </div>
                        ` : ''}
                    </div>
                `).join('');
            }

            resultsSection.classList.add('show');
            resultsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function copyToClipboard(text, button) {
            // Fallback for older browsers
            if (!navigator.clipboard) {
                const textArea = document.createElement('textarea');
                textArea.value = text;
                textArea.style.position = 'fixed';
                textArea.style.left = '-999999px';
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    const originalText = button.textContent;
                    button.textContent = '‚úì Î≥µÏÇ¨Îê®';
                    button.classList.add('copied');
                    
                    setTimeout(() => {
                        button.textContent = originalText;
                        button.classList.remove('copied');
                    }, 2000);
                } catch (err) {
                    console.error('Î≥µÏÇ¨ Ïã§Ìå®:', err);
                    alert('ÌÅ¥Î¶ΩÎ≥¥Îìú Î≥µÏÇ¨Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
                }
                document.body.removeChild(textArea);
                return;
            }

            navigator.clipboard.writeText(text).then(() => {
                const originalText = button.textContent;
                button.textContent = '‚úì Î≥µÏÇ¨Îê®';
                button.classList.add('copied');
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.classList.remove('copied');
                }, 2000);
            }).catch(err => {
                console.error('Î≥µÏÇ¨ Ïã§Ìå®:', err);
                alert('ÌÅ¥Î¶ΩÎ≥¥Îìú Î≥µÏÇ¨Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
            });
        }

        function exportAllFixQueries() {
            const queries = analysisResults.issues
                .filter(issue => issue.fixQuery)
                .map(issue => {
                    return `-- ${issue.title}\n-- ÏúÑÏπò: ${issue.location}\n${issue.fixQuery}\n`;
                })
                .join('\n\n');

            if (queries) {
                const content = [
                    `-- MySQL 8.0 to 8.4 ÏóÖÍ∑∏Î†àÏù¥Îìú ÏàòÏ†ï ÏøºÎ¶¨\n`,
                    `-- ÏÉùÏÑ±ÏùºÏãú: ${new Date().toISOString()}\n`,
                    `-- Ï¥ù ${analysisResults.issues.filter(i => i.fixQuery).length}Í∞úÏùò ÏàòÏ†ï ÏøºÎ¶¨\n\n`,
                    queries
                ].join('');
                
                const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `mysql-upgrade-fix-queries-${new Date().toISOString().split('T')[0]}.sql`;
                a.style.display = 'none';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            } else {
                alert('ÏÉùÏÑ±Ìï† ÏàòÏ†ï ÏøºÎ¶¨Í∞Ä ÏóÜÏäµÎãàÎã§.');
            }
        }

        function exportReport() {
            const report = {
                ...analysisResults,
                exportedAt: new Date().toISOString(),
                version: '1.0.0'
            };

            const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `mysql-upgrade-report-${new Date().toISOString().split('T')[0]}.json`;
            a.style.display = 'none';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function resetAll() {
            uploadedFiles = [];
            analysisResults = {
                issues: [],
                stats: { safe: 0, error: 0, warning: 0, info: 0 }
            };
            
            // UI Ï¥àÍ∏∞Ìôî
            uploadSection.style.display = 'block';
            document.getElementById('actionSection').style.display = 'none';
            document.getElementById('resultsSection').classList.remove('show');
            document.getElementById('progressSection').classList.remove('show');
            folderInput.value = '';
        }
    </script>
</body>
</html>
